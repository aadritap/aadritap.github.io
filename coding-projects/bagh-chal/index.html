<html>
	<head>
	
		<title> Bagh Chal </title>
		<style> 

		body{			
				font-family: 'Brush Script MT', cursive;
				color:white;
				padding: 30px;
		}
			h1 {
				font-size: 80px;
				color: white;
				margin: 20px 0 20px 0;
			}

			
			#canvasContainer{
				position: relative;
				height: 900px;
			}

			canvas{
				position:absolute;
				margin: 0;
				left:0;
				right:0;
				margin-left:auto;
				margin-right:auto;
			}
			#canvasBG{
				z-index:1;
				background-color: #5f6527;
			}
			#canvasUI{
				z-index: 2;
			}
			#myCanvas{
				z-index:3;
				pointer-events: none;
			}

			#restartbtn{
				border-radius: 20px;
				height: 75px;
				width: 150px;
				color: white;
				font-size: 30px;
				font-family: 'Brush Script MT', cursive;
				border: 3px solid white;
				background-color: #784;
				box-shadow: 0px 5px white;
			}
			#restartbtn:hover{
				background-color:#5f6527;
				text-color:#dddddd;
				
				box-shadow: 0px 5px #dddddd;
			}

			#back{
				color: white;
				font-size: 40px;
				text-align: left;
			}
			a:visited, a:link{
				color:white
			}
			a:hover{
				color:#dddddd;
			}

			
			h2 {
				font-size: 60px;
				color: white;
				margin: 20px 0 20px 0;
				text-align: left;
			}
			
			.text{
				text-align: justify;
				font-size: 30px;
				font-family: "Garamond";
			}

		</style>
	</head>

	<body align="center" bgcolor="#5f6527">

		<h1> Bagh-Chal </h1>
		
		<div id="canvasContainer">
			<canvas id="myCanvas" width="1260" height="900"> </canvas>
			<canvas id="canvasBG" width="1260" height="900"> </canvas>
			<canvas id="canvasUI" width="1260" height="900"> </canvas>
		</div>

		
		<button id="restartbtn" onclick="window.location.reload()">Restart</button>

		
		<div id="back"> <a href = "../../"> Back To Main Page </a>  </div> <br>

		<hr>

		<h2> How to Play </h2>
		
		<div class="text">
			<ol>
				<li>One player controls the tigers and one player controls the goats. Players alternate turns</li>
				<li>On their turn, the tiger-player can either move one tiger to an adjacent vertex or capture a goat by jumping over it to an empty vertex</li>
				<li>On their turn, at first the goat-player can only place a goat on any vertex, and once all twenty goats have been placed, can move one goat to an adjacent vertex</li>
				<li>The tigers win if they capture five goats. The goats win if they can surround the tigers and leave them with no moves</li>
				<li>Once all goats have been placed, repetition of the board state is considered a draw</li>
			</ol>
						<a href = "https://en.wikipedia.org/wiki/Bagh-chal">Wikipedia Page on Bagh-Chal</a>
		</div> <br>

		<hr> <br>

		<h2> Game Analysis </h2>
		<div class="text"> 
			<p>After playing a few times, it becomes apparent that a dominant strategy for the goats-player is to place goats on the four corner vertices or in pairs on the edges (neither can ever be captured unless they move!) and close-in from the 'outside-in', placing goats in vertices that make them impossible to capture and suffocating the tigers (once all the goats have been placed, there is only one empty vertex left!). The first goat must be placed in the middle vertex of an outer edge, otherwise the tigers can force a capture. Trying not to lose any goats during this stage is crucial and it doesn't seem that there are many positions where sacrificing a goat gives any sort of advantage. It is not clear what the tigers can 'do', but I noticed a nice configuration for the tigers is a tiger-empty-empty-tiger configuration along any line, since this prevents the opponent from placing a goat on either of the two empty vertices between the tigers. During the second phase of the game, once the goats have been placed, it is interesting that 'zugzwang' frequently occurs; that is, being forced to move is a disadvantage.</p>
			<p> With the above strategy, it seems that it is very easy for the goats to win. This is a very interesting paper: '<a href = "https://web.archive.org/web/20120313050451/http://www.yewjin.com/storage/papers/Computing_Tigers_And_Goats.pdf">Computing Tigers and Goats</a>,' by Lim Yew Jin and J. Nievergelt. Although they were not able to solve the game, the paper more or less echoes the thoughts above, but surprisingly the authors calculated that it is possible for the tigers to force captures of at least three goats, two of them in the first phase of the game!  </p>
<p> The authors give some interesting statistical analysis and describe how they used co-evolution neural networks to analyse the game. They also pose an interesting question, which is also something I was thinking about: Humans like games for which there are some vague principles they can keep in mind to analyse the game (in chess; taking control of the center, 'knights on the rim are dim', weak squares etc.), rather than a purely calculation based game. However, it is unclear whether there are any such nice principles for the game of Bag-Chal, especially if it turns out that it is the tigers who have a winning strategy. Do none exist, which makes this a purely calculation based game, or have we simply not been able to describe any because there aren't currently any human experts in the game? </p>
<p>The fact that the tigers can force a capture of three goats is very interesting to me, and I would like to find out how it is possible and give an easily described strategy for the tigers to do so (aside from tackling the obvious problem of solving the game and finding a winning strategy). It also gives hope that maybe forcing a capture of four or five is actually possible? After all, if it is not even possible to capture four goats, and it seems easy on a human level for the goats to evade capture, why was the number five settled on as the win condition by the creators of the game and over time and history? Maybe there was some theory developed for the game but the knowledge has been lost over time. </p>
		</div>

		<hr>

		<br>
		<div class = "text"> Small note: This program is technically incomplete, as I haven't added win and draw conditions yet. </div>

		<script>

			/*
			1. scale down size
			3. add draw, win conditions
			4. make selection in shape of animal (not hard to do, how to make opacity?)
			5. add click audio, growl audio and bleating sound
			*/

			/* ---------------------------------------------------------------- background canvas -------------------------------------------*/
			
			var bg_image = new Image();
			bg_image.src = "background.jpg";

			var canvasbg = document.getElementById("canvasBG");
			var ctxbg = canvasbg.getContext("2d");
			bg_image.onload = function (){			
				ctxbg.drawImage (bg_image, 230, 0, 800, 800);
				console.log("background loaded");
			}


			/* -------------------------------------------------------------------gameplay canvas--------------------------------------------*/
			//setting up canvas, importing images

			var myCanvas = document.getElementById ("myCanvas");
			var ctx = myCanvas.getContext("2d");

			var tiger_image = new Image();
			tiger_image.src = "tiger.png";
			tiger_image.onload = function (){
				console.log("tiger loaded");
				updateBoard();
			}

			var lamb_image = new Image();
			lamb_image.src = "lamb.png";
			lamb_image.onload = function (){
				console.log("lamb loaded");
				updateBoard();
			}


			//function for drawing background: not being used anymore
			/*
			drawBackground();
			function drawBackground(){

				ctx.beginPath();

				for (var i=100; i<=700; i+=150){
					ctx.moveTo(i, 100);
					ctx.lineTo(i, 700);

					ctx.moveTo(100, i);
					ctx.lineTo(700, i);
				}

				ctx.moveTo (100,100);
				ctx.lineTo(700, 700);

				ctx.moveTo (100,700);
				ctx.lineTo(700, 100);

				ctx.moveTo (100,400);
				ctx.lineTo (400, 100);

				ctx.moveTo (700,400);
				ctx.lineTo (400, 700);

				ctx.moveTo (400,100);
				ctx.lineTo (700, 400);

				ctx.moveTo (400,100);
				ctx.lineTo (700, 400);

				ctx.moveTo (100, 400);
				ctx.lineTo (400, 700);

				ctx.lineWidth = 2;
				ctx.stroke();
			}
			*/

			var killedLambs = 0;
			var unplacedLambs = 20;

			function updateBoard(){
				ctx.clearRect(0, 0, 1260, 800);

				//drawBackground();
				for (var i=0; i<5; i++){
					for (var j=0; j<5; j++){
						if (board[i][j]=="tiger"){
							draw_tiger(i, j);
						}
						if (board[i][j]=="lamb"){
							draw_lamb(i, j);
						}
					}
				}
				for (var i=0; i<unplacedLambs; i++){
					draw_unplaced_lamb(i);
				}				
				for (var i=0; i<killedLambs; i++){
					draw_dead_lamb(i);
				}
			}

			function draw_tiger (y, x){
				ctx.drawImage (tiger_image, (330+x*150)-60, (100+y*150)-60, 120, 120);
			}

			function draw_lamb (y, x) {
				ctx.drawImage (lamb_image, (330+x*150)-65, (100+y*150)-65, 130, 130);
			}
		
			function draw_unplaced_lamb (i){
				if (i<10){
					ctx.drawImage (lamb_image, 20, (55+i*75)-45, 90, 90);
				} else {
					ctx.drawImage (lamb_image, 120, (55+(i-10)*75)-45, 90, 90);
				}
			}

			function draw_dead_lamb (i){
				if (i<10){
					ctx.drawImage (lamb_image, 1050, (55+i*75)-45, 90, 90);
				} else {
					ctx.drawImage (lamb_image, 1150, (55+(i-10)*75)-45, 90, 90);
				}
			}

			/*-------------------------------------------------- mouse-events and the UI canvas -----------------------------------------------------*/

			
			var cui = document.getElementById ("canvasUI");
			var ctxui = cui.getContext("2d");

			var tomove = "placelamb";
			var selectedTiger = [0,0];
			var selectedLamb = [0,0];

			//handling mouse hovering UI

			cui.addEventListener("mousemove", mouseMove, false);

			function mouseMove (e){
			
				ctxui.clearRect (0, 0, cui.width, cui.height);
				if (tomove == "tiger2"){
					draw_tiger_selection (selectedTiger[0], selectedTiger[1]);
				}
				if (tomove == "lamb2"){
					draw_lamb_selection (selectedLamb[0], selectedLamb[1]);
				}

				var pos = getMousePos (e);

				//case where we're adding lambs
				if (tomove == "placelamb") {
					var mousex = e.pageX - cui.offsetLeft - document.getElementById("canvasContainer").offsetLeft;
					var mousey = e.pageY - cui.offsetTop - document.getElementById("canvasContainer").offsetTop;
					
					if (pos!=-1 && board[pos[1]][pos[0]]=="empty") {
						draw_ui_lamb(330+(pos[0]*150), 100+(pos[1]*150));
					} else {
						if (mousex>=230 && mousex <= 1030 && mousey >= 19 && mousey<=790){
							draw_ui_lamb(mousex, mousey);
						}
					}
				}

				if (pos!=-1){

					//case where we're in part 1 of moving lamb
					if (tomove == "lamb1"){
						if (board[pos[1]][pos[0]] == "lamb"){
							draw_lamb_selection(pos[0], pos[1]);
						}
					}

					//case where we're in part 2 of moving lamb
					if (tomove == "lamb2"){
							
						if (board[pos[1]][pos[0]] == "empty"){
							var tox = pos[1];
							var toy = pos[0];
							var fromx = selectedLamb[1];
							var fromy = selectedLamb[0];

							var dx = Math.abs(fromx - tox);
							var dy = Math.abs(fromy - toy);
						
							if ((dx==1 && dy==0) || (dx==0 && dy==1) || (dx==1 && dy==1 && ((fromx+fromy) % 2) ==0)){
								draw_lamb_move_selection(pos[0], pos[1]);
							}
						} else if (board[pos[1]][pos[0]] == "lamb") {
							ctxui.clearRect (0, 0, cui.width, cui.height);
							draw_lamb_selection(pos[0], pos[1]);
						}
					}

					//case where we're in part 1 of moving tiger
					if (tomove == "tiger1"){
						if (board[pos[1]][pos[0]] == "tiger"){
							draw_tiger_selection(pos[0], pos[1]);
						}
					}

					//case where we're in part 2 of moving tiger
					if (tomove == "tiger2"){
							
						if (board[pos[1]][pos[0]] == "empty"){
							var tox = pos[1];
							var toy = pos[0];
							var fromx = selectedTiger[1];
							var fromy = selectedTiger[0];

							var dx = Math.abs(fromx - tox);
							var dy = Math.abs(fromy - toy);
						
							if ((dx == 2 && dy == 2 && ((fromx+fromy) % 2) ==0) || (dx == 2 && dy == 0) || (dx == 0 && dy == 2)){
								if (board[Math.floor((fromx+tox)/2)][Math.floor((fromy+toy)/2)] == "lamb"){
									draw_tiger_move_selection(pos[0], pos[1]);
								}
							}
							if ((dx==1 && dy==0) || (dx==0 && dy==1) || (dx==1 && dy==1 && ((fromx+fromy) % 2) ==0)){
								draw_tiger_move_selection(pos[0], pos[1]);
							}
						} else if (board[pos[1]][pos[0]] == "tiger") {
							ctxui.clearRect (0, 0, cui.width, cui.height);
							draw_tiger_selection(pos[0], pos[1]);
						}
					}
				}
			}

			//adding mouseclick UI
			cui.addEventListener("click", mouseClick, false);
			function mouseClick(e){
				var pos = getMousePos(e);

				if (pos!=-1){

					//case where we're adding lambs
					if (tomove == "placelamb"){
						if (addLamb (pos[1], pos[0])){
							updateBoard();
							ctxui.clearRect (0, 0, cui.width, cui.height);
							tomove = "tiger1";
							cui.style.zIndex = "2";
							
							write_message("");
						}
					}

					//case where we're moving lamb
					if (tomove == "lamb1"){
						if (board[pos[1]][pos[0]]=="lamb"){
							selectedLamb = pos;
							tomove = "lamb2";

							write_message("");
						}
					} else if (tomove == "lamb2"){
						if (board[pos[1]][pos[0]]=="lamb"){
							ctxui.clearRect (0, 0, cui.width, cui.height);
							selectedLamb = pos;
							draw_lamb_selection(pos[0], pos[1]);
							tomove = "lamb2";

							write_message("");

						} else if (moveLamb (selectedLamb[1], selectedLamb[0], pos[1], pos[0])){
							updateBoard();
							ctxui.clearRect (0, 0, cui.width, cui.height);
							tomove = "tiger1";
						
							write_message("");
						}
					}

					//case where we're moving tiger
					if (tomove == "tiger1"){
						if (board[pos[1]][pos[0]]=="tiger"){
							selectedTiger = pos;
							tomove = "tiger2";
						
							write_message("");
						}
					} else if (tomove == "tiger2"){
						if (board[pos[1]][pos[0]]=="tiger"){
							
							ctxui.clearRect (0, 0, cui.width, cui.height);
							selectedTiger = pos;
							draw_tiger_selection(pos[0], pos[1]);
							tomove = "tiger2";

							
							write_message("");

						} else if (moveTiger (selectedTiger[1], selectedTiger[0], pos[1], pos[0])){
							updateBoard();
							ctxui.clearRect (0, 0, cui.width, cui.height);
							if (unplacedLambs > 0){
								tomove = "placelamb";
								cui.style.zIndex = "4";
							} else {
								tomove = "lamb1";
							}
							//writing halum message in other function
						}
					}
				}
			}

			//snapping to coordinate
			var mouseRadius = 25;

			function getMousePos (e){

				var mousex = e.pageX - cui.offsetLeft - document.getElementById("canvasContainer").offsetLeft;
				var mousey = e.pageY - cui.offsetTop - document.getElementById("canvasContainer").offsetTop;
				var boardx = mousex - 330;
				var boardy = mousey - 100;

				if (boardx<-mouseRadius || boardx>600+mouseRadius || boardy<-mouseRadius || boardy>600+mouseRadius){
					return -1;
				}
				
				if ((boardx%150<=mouseRadius || boardx%150>=150-mouseRadius) && (boardy%150<=mouseRadius || boardy%150>=150-mouseRadius)){
					return [Math.round (boardx/150), Math.round(boardy/150)];
				}

				return -1;
			}

			//drawing functions

			function draw_ui_lamb (x, y) {
				ctxui.drawImage (lamb_image, x-65, y-65, 130, 130);
			}

			function draw_tiger_selection(x,y){
				ctxui.beginPath();
				ctxui.arc((330+x*150), (100+y*150), 55, 0, 2 * Math.PI);
				ctxui.fillStyle = "rgb(95 101 39 / 50%)";
				ctxui.fill();
				ctxui.lineWidth = 0.1;
				ctxui.stroke()
			}

			function draw_tiger_move_selection(x,y){
				ctxui.beginPath();
				ctxui.arc((330+x*150), (100+y*150), 35, 0, 2 * Math.PI);
				ctxui.fillStyle = "rgb(95 101 39 / 50%)";
				ctxui.fill();
				ctxui.lineWidth = 0.1;
				ctxui.stroke();
			}

			function draw_lamb_selection(x,y){
				ctxui.beginPath();
				ctxui.arc((330+x*150), (100+y*150), 50, 0, 2 * Math.PI);
				ctxui.fillStyle = "rgb(150 150 150 / 50%)";
				ctxui.fill();
				ctxui.lineWidth = 0.1;
				ctxui.stroke();
			}

			function draw_lamb_move_selection(x,y){
				ctxui.beginPath();
				ctxui.arc((330+x*150), (100+y*150), 35, 0, 2 * Math.PI);
				ctxui.fillStyle = "rgb(150 150 150 / 50%)";
				ctxui.fill();
				ctxui.lineWidth = 0.1;
				ctxui.stroke();
			}

			function write_message(msg){
				ctx.clearRect (0, 800, 1260, 100);
				ctx.font = "50px Brush Script MT";
				ctx.fillStyle = "rgb(255 255 255)";
				var w = ctx.measureText(msg).width;
				ctx.fillText(msg, 630-(w/2), 865);
			}
		
			/*------------------------------------------------------------------- logic, backend -----------------------------------------------------*/

			var board = []
			for (var i=0; i<5; i++){
				board.push([]);
				for (var j=0; j<5; j++){
					board[i].push("empty");
				}
			}
			board[0][0]="tiger";
			board[0][4]="tiger";
			board[4][0]="tiger";
			board[4][4]="tiger";

			function moveTiger (fromx, fromy, tox, toy){
				if (board[fromx][fromy] == "tiger" && board[tox][toy] == "empty"){
					var dx = Math.abs(fromx - tox);
					var dy = Math.abs(fromy - toy);
					if ((dx == 2 && dy == 2 && ((fromx+fromy) % 2) ==0) || (dx == 2 && dy == 0) || (dx == 0 && dy == 2)){
						if (board[Math.floor((fromx+tox)/2)][Math.floor((fromy+toy)/2)] == "lamb"){
							board[fromx][fromy] = "empty";
							board[Math.floor((fromx+tox)/2)][Math.floor((fromy+toy)/2)] = "empty";
							board[tox][toy] = "tiger";
							killedLambs++;

							
							write_message("হালুম"+"!"); //bad
							return true;
						}
					}
					if ((dx==1 && dy==0) || (dx==0 && dy==1) || (dx==1 && dy==1 && ((fromx+fromy) % 2) ==0)){
						board[fromx][fromy] = "empty";
						board[tox][toy] = "tiger";
						return true;
					}
				}
				return false;
			}

			function addLamb (x, y){
				if(board[x][y]=="empty" && unplacedLambs > 0){
					board[x][y]="lamb";
					unplacedLambs--;

					return true;
				}
				return false;
			}
			

			function moveLamb (fromx, fromy, tox, toy){
				if (board[fromx][fromy] == "lamb" && board[tox][toy] == "empty" && unplacedLambs == 0){
					var dx = Math.abs(fromx - tox);
					var dy = Math.abs(fromy - toy);
					if ((dx==1 && dy==0) || (dx==0 && dy==1) || (dx==1 && dy==1 && ((fromx+fromy) % 2) ==0)){
						board[fromx][fromy] = "empty";
						board[tox][toy] = "lamb";
						return true;
					}
				}
				return false;
			}

			/*------------------------------------------------------random play------------------------------------------------------*/
			
			/*
			var toMove = "tiger";
			var interval = setInterval(function(){

				if (toMove == "tiger"){
					while (true){
						var fromx = Math.floor(Math.random() * 5);
						var fromy = Math.floor(Math.random() * 5);
						var tox = Math.floor(Math.random() * 5);
						var toy = Math.floor(Math.random() * 5);
						//console.log("Tiger: (" +fromx +", "+fromy+") -> (" + tox +", "+toy+")");
						if (moveTiger(fromx, fromy, tox, toy)){
							break;
						}
					}
					toMove = "lamb";
				} else {
					if (unplacedLambs == 0){
						while(true){
							var fromx = Math.floor(Math.random() * 5);
							var fromy = Math.floor(Math.random() * 5);
							var tox = Math.floor(Math.random() * 5);
							var toy = Math.floor(Math.random() * 5);
							//console.log("Lamb: (" +fromx +", "+fromy+") -> (" + tox +", "+toy+")");
							if (moveLamb(fromx, fromy, tox, toy)){
								break;
							}
						}
					} else {
						while(true){
							var x = Math.floor(Math.random() * 5);
							var y = Math.floor(Math.random() * 5);
							//console.log ("Lamb: (" +x +", "+y+")");
							if (addLamb (x,y)){
								break;
							}
						}
					}
					toMove = "tiger";
				}
				updateBoard();
				console.log(board);

				if (killedLambs >= 5){
					clearInterval(interval);
					//document.getElementById("gameResult").innerHTML="Tigers win";
				}
			}, 500);*/
			
		</script>

	</body>

</html>